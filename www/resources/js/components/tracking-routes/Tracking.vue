<template>
    <l-map style="height: 500px"
        :zoom="zoom"
        :center="center">
        <l-tile-layer :url="url"></l-tile-layer>
        <l-marker
            :lat-lng="markerPartenza"
            :icon="carIcon"
            >
            <l-tooltip :options="markerToolTipOptions">Partenza!</l-tooltip>
        </l-marker>
        <l-marker
            :lat-lng="markerArrivo"
            :icon="carIcon"
            >
            <l-tooltip :options="markerToolTipOptions">Arrivo!</l-tooltip>
        </l-marker>
        <l-polyline :lat-lngs="polyline.latlngs" :color="polyline.color"></l-polyline>
    </l-map>
</template>

<style scoped>

</style>

 <!--
    select replace(replace(replace(replace(json_data, '"', ''), ':', ','), '{', '['), '}', ']')
    from
    (
	    select JSON_ARRAYAGG(JSON_OBJECT(latitude, longitude)) as json_data from tracking_data
    ) tmp
-->
<script>
/* OpenStreetMap VueJS.
    components  https://vue2-leaflet.netlify.app/components/
    examples    https://vue2-leaflet.netlify.app/examples/
*/
import { latLng, icon } from "leaflet";
import { LMap, LTileLayer, LMarker, LPopup, LTooltip, LPolyline } from "vue2-leaflet";
import 'leaflet/dist/leaflet.css'

export default {
    components: {
        LMap,
        LTileLayer,
        LMarker,
        LPopup,
        LTooltip,
        LPolyline
    },

    // #region Properties
    data() {
        return {
            url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
            zoom: 20,
            center: [44.6466681, 10.9307469],
            markerPartenza: [44.6466681, 10.9307469],
            markerArrivo: [44.6496961, 10.8033151],
            polyline: {
                latlngs: [[44.6466681, 10.9307469], [44.6466241, 10.9308496], [44.6465734, 10.930923], [44.646604, 10.9308399], [44.6468114, 10.930535], [44.6469002, 10.9306233], [44.6470535, 10.9307331], [44.6471774, 10.9309597], [44.6469083, 10.9317969], [44.6469083, 10.9317969], [44.6469083, 10.9317969], [44.6474327, 10.9310026], [44.6472308, 10.9310031], [44.6469007, 10.9304248], [44.6468539, 10.9304057], [44.6471626, 10.9306365], [44.647777, 10.9310384], [44.6476409, 10.9310328], [44.6478221, 10.9311625], [44.6479189, 10.9312048], [44.6477941, 10.9324443], [44.6477901, 10.9324735], [44.647863, 10.9319522], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.6493267, 10.93824], [44.64941, 10.9303017], [44.64941, 10.9303017], [44.64941, 10.9303017], [44.64941, 10.9303017], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6479277, 10.9311345], [44.6482383, 10.9311188], [44.6487283, 10.934245], [44.6483172, 10.9346108], [44.6491033, 10.9321167], [44.6491033, 10.9321167], [44.6491033, 10.9321167], [44.6491033, 10.9321167], [44.6491033, 10.9321167], [44.6491033, 10.9321167], [44.6491033, 10.9321167], [44.6491994, 10.9308705], [44.6528534, 10.9274823], [44.6528534, 10.9274823], [44.6528534, 10.9274823], [44.6528534, 10.9274823], [44.6529485, 10.9273201], [44.6534538, 10.9263187], [44.6544007, 10.9239617], [44.6560282, 10.9213333], [44.6577023, 10.9171204], [44.6588157, 10.9147031], [44.6585134, 10.9143996], [44.6583444, 10.9117719], [44.6579774, 10.9107152], [44.6567516, 10.9090045], [44.6554403, 10.9075618], [44.6547471, 10.9070553], [44.6547826, 10.9071389], [44.6547849, 10.9071664], [44.6547699, 10.9066433], [44.6546845, 10.9029998], [44.6572161, 10.9002703], [44.6572404, 10.9002115], [44.6572751, 10.9002164], [44.6572989, 10.8998351], [44.6572989, 10.8998351], [44.6583526, 10.8942823], [44.6581467, 10.8908283], [44.6577377, 10.8875325], [44.6571077, 10.8837037], [44.6571476, 10.8837352], [44.6568266, 10.8817253], [44.6560108, 10.8804419], [44.6547334, 10.8757921], [44.6546064, 10.8750125], [44.6543105, 10.874838], [44.6538834, 10.8739558], [44.6526222, 10.872149], [44.6512421, 10.8694899], [44.6509391, 10.8679001], [44.6491283, 10.8625833], [44.6463817, 10.856595], [44.6462544, 10.8559291], [44.6462901, 10.8551088], [44.6465017, 10.8535006], [44.6469082, 10.8502561], [44.6457333, 10.85544], [44.6476717, 10.8470817], [44.6477377, 10.8430828], [44.6476798, 10.8421959], [44.6476798, 10.8421959], [44.6483933, 10.8365133], [44.6485967, 10.8331417], [44.650085, 10.8197083], [44.6508648, 10.8129292], [44.6511362, 10.8098383], [44.6512744, 10.8084455], [44.6514532, 10.8070831], [44.6515597, 10.8053341], [44.6516006, 10.8035039], [44.6516483, 10.8042867], [44.6516483, 10.8042867], [44.6516096, 10.8047174], [44.651402, 10.8064237], [44.6513819, 10.806516], [44.6513868, 10.8065035], [44.6513868, 10.8065035], [44.6513167, 10.8073432], [44.6513453, 10.8077454], [44.6509802, 10.8084042], [44.6502851, 10.8086882], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.602257, 10.7945642], [44.6022527, 10.794563], [44.6022561, 10.7945608], [44.6022367, 10.7945779], [44.6022527, 10.794563], [44.6046052, 10.7946601], [44.6098726, 10.7943655], [44.6094458, 10.7943204], [44.6129452, 10.7943119], [44.6152158, 10.7946548], [44.6177073, 10.7943876], [44.6253265, 10.7956295], [44.6260146, 10.7963662], [44.6396981, 10.8043496], [44.6411122, 10.8051378], [44.642644, 10.8051015], [44.6512667, 10.8082438], [44.6512667, 10.8082438], [44.6514203, 10.8067908], [44.6496961, 10.8033151]],
                color: 'red'
            },
            // markers tooltip options
            markerToolTipOptions: {
                permanent: true,
                opacity: 0.2
            },
            // markers custom icons
            carIcon: icon({
                iconUrl: "https://image.flaticon.com/icons/png/512/65/65578.png",
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            }),
        }
    },
    // #endregion Properties

    // #region Component Life Cycle
    created() {
    },
    mounted() {
        console.log('Tracking.vue mounted')
        console.log(this.$route.query.session_id)
    }
    // #endregion Component Life Cycle
}
</script>
