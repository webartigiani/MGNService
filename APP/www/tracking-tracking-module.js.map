{"version":3,"sources":["./src/app/tracking/tracking-routing.module.ts","./src/app/tracking/tracking.page.ts","./src/app/tracking/tracking.page.scss","./src/app/tracking/tracking.module.ts","./src/app/tracking/tracking.page.html"],"names":[],"mappings":"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","file":"tracking-tracking-module.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { TrackingPage } from './tracking.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: TrackingPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class TrackingPageRoutingModule {}\n","import { Component } from '@angular/core';\nimport { environment } from \"src/environments/environment\";\n\nimport { NavController, Platform } from '@ionic/angular';\n\n// WebArtigiani Classes\nimport { AppService } from '../Classes/App';\nimport { ApiService } from '../Classes/API';\nimport { UtilsService } from '../Classes/Utils';\nimport { ComponentsService } from '../Classes/Components';\nimport { GeoLocationService } from '../Classes/GeoLocation';\nimport { LocalDataService } from '../Classes/LocalData';\nimport { PhoneServices } from '../Classes/Phone';\n\n@Component({\n  selector: 'app-tracking',\n  templateUrl: './tracking.page.html',\n  styleUrls: ['./tracking.page.scss'],\n})\nexport class TrackingPage {\n\n  // #region Variables\n  current_worker = this.localData.readObject('current_worker', {})    // current worker and veichle\n  current_veichle = this.localData.readObject('current_veichle', {})\n  statusDesc = 'continua verso la tua destinazione...'\n  instructions = [\n    'raggiunta la tua destinazione, clicca \"Stop\"',\n    'per fermarti lungo il tragitto, clicca \"Pausa',\n    'per emergenze, clicca \"SOS\"'\n  ]\n  counter: number = 0                       // contatore tracciamenti\n  sessionID: string = ''\n  gpsData: any = {}\n  isPaued: boolean = false\n  alreadyPaused: boolean = false\n  iTimer: any = null                        // setInterval\n  // #endregion Variables\n\n  // #region Constructor\n  constructor(\n    // WebArtigiani\n    public app: AppService,\n    private api: ApiService,\n    private utils: UtilsService,\n    private components: ComponentsService,\n    private geolocation: GeoLocationService,\n    private localData: LocalDataService,\n    private phone: PhoneServices,\n\n    // Angular\n    public platform: Platform,\n    public navCtrl: NavController\n  ) {\n    // Constructor code...\n\n    // gets current session_id from storage\n    this.sessionID = this.localData.readValue('session_id');\n  }\n  // #endregion Constructor\n\n  // #region Component LifeCycle\n  ngAfterViewInit() {\n\n    // keep screen awake + keeps APP in foreground\n    this.utils.keepScreenAwake()\n    this.utils.keepForeground()\n\n    // 1st geo-location, then geo-locate by interval\n    this.geoLocate()\n    this.iTimer = setInterval(() => {\n      this.geoLocate()\n    }, environment.LOCATION_INERVAL * 1000);\n  }\n  // #endregion Component LifeCycls\n\n  // #region Public Methods\n  pause() {\n    /**\n     * Do a Pause\n     */\n    if (this.alreadyPaused) {\n      // pause already used\n      this.components.showAlert('Pausa', 'Pausa non disponibile', 'Hai già usufruito di una pausa lungo il tragitto.',0,'Ho capito')\n      return;\n    }\n\n    // ask for confirmation\n    this.components.showConfirm('Pausa','Hai a disposizione una sola pausa lungo il tragitto','Confermi di voler usufruire della tua pausa ora?', ['No', 'Si']).then((result) => {\n      if (!result) return;\n      this.isPaued = true\n      this.alreadyPaused = true     // sets pause already used\n      this.components.showAlert('In Pausa', 'Tragitto in pausa', 'Per riprendere il tuo tragitto, clicca sul pulsante \"Riprendi\" al termine della pausa.', environment.MAX_PAUSE_TIMEOUT * 60 * 1000, 'Riprendi').then((result) => {\n        this.isPaued = false\n      })\n    })\n  }\n  stop() {\n    /**\n     * Stops Geo-Locate\n     */\n\n    this.components.showConfirm('Conferma', 'Hai raggiunto la destinazione?', 'Confermi di volere interrompere il tragitto?', ['No', 'Si']).then((result) => {\n        if (result) {\n\n          // shows loader then calls API to login\n          this.components.getLoader('Attendi...').then((loading) => {\n            loading.present()\n\n            this.api.stopTracking(this.sessionID).then((result) => {\n              // stopTracking OK\n              loading.dismiss()\n              this.stopTracker()\n            }).catch((error) => {\n              // API Error\n              console.error(error)\n              loading.dismiss()\n            })\n          })\n        } else {\n          // Do not stop!\n        }\n    })\n  }\n  stopTracker() {\n    /**\n     * Stops the tracker\n     */\n     clearInterval(this.iTimer)                  // stops interval\n     this.iTimer = null\n     this.localData.delete('session_id')\n     this.localData.delete('current_worker')\n     this.localData.delete('current_veichle')\n     this.navCtrl.navigateRoot('login-veichle')\n  }\n\n  SOS() {\n    /**\n     * starts a calling to the SOS number\n     */\n     this.components.showConfirm('SOS','Avvia chiamata SOS','Avviare una chiamata al numero di SOS ' + environment.SOS_PHONE_NUMBER + '?', ['Annulla', 'OK']).then((result) => {\n      if (result) this.phone.call(environment.SOS_PHONE_NUMBER)\n    })\n  }\n\n  geoLocate() {\n    /**\n     * Geo-locate the device\n     */\n\n    this.geolocation.locate().then((data) => {\n      /**\n       * Geo-location OK\n       * we call continueTracking API\n       */\n      if (data.valid) {\n        this.gpsData = data\n        this.counter++\n      }\n\n      const navigationStatus =  this.isPaued ? 'pause': 'running'     // status paused/running\n      this.api.continueTracking(this.sessionID, data, navigationStatus)\n      .then((result) => {\n        // continueTracking OK\n\n      }).catch((error) => {\n        // API Error\n        if (error.http_status.code === 404) {\n\n          // ERORR 404 returned by server\n          // tracking session stopped by admin\n          this.components.showAlert('Navigazione Interrotta', 'Navigazione interrotta da remoto', 'La navigazione di questo veicolo è stata interrotta da remoto dallo Staff di MGN.', 3000).then((result) => {\n            this.stopTracker()\n          })\n          return\n        }\n\n        // other API errors\n        console.error(error)\n      });\n    }).catch((error) => {\n      // geo-location error\n      console.error('Geo-location error', error)\n    })\n  }\n  // #endregion Public Methods\n\n  // #region Private Methods\n  // #endregion Private Methods\n}\n","export default \"div#debug {\\n  position: absolute;\\n  width: 100%;\\n  height: 80px;\\n  bottom: 80px;\\n  background-color: orange;\\n  color: blue;\\n  font-size: 0.75em;\\n  font-style: italic;\\n}\\n\\nul.instructions li {\\n  text-align: left;\\n  font-size: 0.75em;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3RyYWNraW5nLnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGtCQUFBO0VBQ0EsV0FBQTtFQUNBLFlBQUE7RUFDQSxZQUFBO0VBQ0Esd0JBQUE7RUFDQSxXQUFBO0VBQ0EsaUJBQUE7RUFDQSxrQkFBQTtBQUNGOztBQUVBO0VBQ0UsZ0JBQUE7RUFDQSxpQkFBQTtBQUNGIiwiZmlsZSI6InRyYWNraW5nLnBhZ2Uuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbImRpdiNkZWJ1ZyB7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgd2lkdGg6MTAwJTtcbiAgaGVpZ2h0OjgwcHg7XG4gIGJvdHRvbTo4MHB4O1xuICBiYWNrZ3JvdW5kLWNvbG9yOiBvcmFuZ2U7XG4gIGNvbG9yOmJsdWU7XG4gIGZvbnQtc2l6ZTogLjc1ZW07XG4gIGZvbnQtc3R5bGU6IGl0YWxpYztcbn1cblxudWwuaW5zdHJ1Y3Rpb25zIGxpIHtcbiAgdGV4dC1hbGlnbjogbGVmdDtcbiAgZm9udC1zaXplOiAuNzVlbTtcbn1cbiJdfQ== */\";","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { TrackingPageRoutingModule } from './tracking-routing.module';\n\nimport { TrackingPage } from './tracking.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    TrackingPageRoutingModule\n  ],\n  declarations: [TrackingPage]\n})\nexport class TrackingPageModule {}\n","export default \"<ion-header [translucent]=\\\"true\\\">\\n  <ion-toolbar>\\n    <ion-title>\\n      <img src=\\\"assets/icon/favicon.png\\\" class=\\\"title-icon\\\">\\n      {{ app.appName() }}\\n    </ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<!-- content -->\\n<ion-content [fullscreen]=\\\"true\\\" class=\\\"center\\\">\\n  <h3>{{ current_worker.name }} {{ current_worker.surname }}</h3>\\n  <img src=\\\"assets/ani/car.gif\\\" />\\n  <br>\\n  <div id=\\\"statusDesc\\\">\\n    <p [innerHTML]=\\\"statusDesc\\\"></p>\\n  </div>\\n  <ul class=\\\"instructions\\\">\\n    <li *ngFor=\\\"let sInstr of this.instructions\\\" [value]=\\\"sInstr\\\">{{ sInstr }}</li>\\n  </ul>\\n\\n  <!-- SOS Caller -->\\n  <ion-button\\n    (click)=\\\"SOS()\\\"\\n    shape=\\\"round\\\"\\n    size=\\\"large\\\"\\n    class=\\\"btn-app red\\\"\\n  ><ion-icon name=\\\"call-outline\\\"></ion-icon>SOS</ion-button>\\n\\n\\n  <!-- debug GPS data (if DEBUG_GPS==true) -->\\n  <div id=\\\"debug\\\"\\n    *ngIf=\\\"app.debugGPS()\\\"\\n    >\\n    {{ gpsData.latitude }}<br>\\n    {{ gpsData.longitude }}<br>\\n    accuracy: {{ gpsData.accuracy }}mt<br>\\n    distance: {{ gpsData.distance }}mt<br>\\n    {{ counter }}\\n  </div>\\n</ion-content>\\n\\n<!-- Footer -->\\n<ion-footer class=\\\"ion-no-border\\\">\\n  <ion-grid>\\n    <ion-row no-padding no-margin>\\n        <ion-col col-12 no-padding class=\\\"center\\\">\\n          <!-- pause button -->\\n          <ion-button\\n            (click)=\\\"pause()\\\"\\n            shape=\\\"round\\\"\\n            size=\\\"large\\\"\\n            class=\\\"btn-app orange\\\"\\n          >\\n            <ion-icon name=\\\"pause-circle-outline\\\"></ion-icon>\\n          </ion-button>\\n\\n          <ion-button\\n            (click)=\\\"stop()\\\"\\n            shape=\\\"round\\\"\\n            size=\\\"large\\\"\\n            class=\\\"btn-app red\\\"\\n          ><ion-icon name=\\\"stop-circle-outline\\\"></ion-icon></ion-button>\\n        </ion-col>\\n    </ion-row>\\n  </ion-grid>\\n</ion-footer>\\n\";"],"sourceRoot":"webpack:///"}