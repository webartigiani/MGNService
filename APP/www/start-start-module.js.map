{"version":3,"sources":["./src/app/start/start.page.ts","./src/app/start/start.page.html","./src/app/start/start.page.scss","./src/app/start/start-routing.module.ts","./src/app/start/start.module.ts"],"names":[],"mappings":"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","file":"start-start-module.js","sourcesContent":["/*\n * start/start.page\n * start/loading page\n * route: start (default route)\n *\n * NOTES:\n *  this is the 1st page loaded when APP starts\n *\n *  step 1: checks internet connection\n *  step 2: try to ping the MGN server API\n *  step 3: checks geo-location service\n *\n *  each step is shown into div#statusDesc\n *  step 4: if everything's ok registers/updates the device via API, then navigate to login page\n */\nimport { Component } from '@angular/core';\nimport { environment } from \"src/environments/environment\";\n\nimport { NavController } from '@ionic/angular';\n\n// WebArtigiani Classes\nimport { AppService } from '../Classes/App';\nimport { ApiService } from '../Classes/API';\nimport { UtilsService } from '../Classes/Utils';\nimport { ComponentsService } from '../Classes/Components';\nimport { GeoLocationService } from '../Classes/GeoLocation';\nimport { LocalDataService } from '../Classes/LocalData';\nimport { PhoneServices } from '../Classes/Phone';\n\n@Component({\n  selector: 'app-start',\n  templateUrl: './start.page.html',\n  styleUrls: ['./start.page.scss'],\n})\nexport class StartPage {\n\n  // #region Variables\n  statusDesc: string = 'caricamento...'\n  statusError: boolean = false\n  execDelay: number = 0.25                       // numero di secondi di attesa esecuzione\n  retryDelay: number = 3                        // numero di secondi per retrial\n  // #endregion Variables\n\n  // #region Constructor\n  constructor(\n      // WebArtigiani\n      public app: AppService,\n      private api: ApiService,\n      private utils: UtilsService,\n      private components: ComponentsService,\n      private geolocation: GeoLocationService,\n      private localData: LocalDataService,\n      private phone: PhoneServices,\n\n      // Angular\n      public navCtrl: NavController,\n  ) {\n    // Constructor code...\n  }\n  // #endregion Constructor\n\n  // #region Component LifeCycle\n  ngOnInit() {\n    /*\n    Initialize the directive or component\n    after Angular first displays the data-bound properties and sets the directive or component's input properties.\n    Called once\n    */\n    this.app.checkUpdates()\n  }\n  ngAfterViewInit() {\n    console.log('start', 'ngAfterViewInit')\n\n    // allows screen falling asleep (NOTE: here, we DO NOT keep APP in foreground)\n    this.utils.allowScreenFallAsleep()\n    //this.utils.keepForeground()\n\n    // starts steps...\n    setTimeout(() => {\n      this.checkConnection()\n    }, this.execDelay * 1000 * 2);\n\n  }\n  // #endregion Component LifeCycls\n\n  // #region Public Methods\n  checkConnection() {\n    /**\n     * step 1: checks internet connection\n     */\n\n    this.statusDesc = 'verifica connessione...'\n\n    setTimeout(() => {\n      // 0.5\" before we really check connection\n\n      if (this.utils.isDeviceOnLine()) {\n        // device connected:\n        this.statusDesc = 'connessione OK'\n        setTimeout(() => {\n          this.pingServer()\n        }, this.execDelay * 1000);\n      } else {\n        // device not connected: retry in 1\"\n        this.statusDesc = 'Connessione Assente.<br><br>Attiva la connessione dati del tuo dispositivo.'\n        setTimeout(() => {\n          this.checkConnection()     // retry All in 3\"\n        }, this.retryDelay * 1000);\n      }\n    }, this.execDelay * 1000);\n  }\n\n  pingServer() {\n    /**\n     * step 2: try to ping server\n     * */\n    this.statusDesc = 'connessione al server MGN...'\n\n    setTimeout(() => {\n      this.api.ping().then((result) => {\n        // ping OK\n        this.statusDesc = 'Connessione al server MGN Ok'\n        setTimeout(() => {\n          this.checkGeoLocationService()\n        }, this.execDelay * 1000);\n      }).catch((error) => {\n        // ping Error\n        this.statusDesc = 'Server MGN non raggiungibile.<br><br>Nuovo tentativo in ' + this.retryDelay  + '\"...'\n        setTimeout(() => {\n          this.checkConnection()      // retry All in 3\"\n        }, this.retryDelay * 1000);\n      })\n    }, this.execDelay * 1000);\n  }\n\n  checkGeoLocationService() {\n    /**\n     * step 3: checks geo-location service\n     */\n    this.statusDesc = 'verifica servizio GPS...'\n\n    setTimeout(() => {\n      this.geolocation.checkService().then((data) => {\n        // Geo-location service OK\n\n        this.statusDesc = 'Avvio in corso...'\n        this.registerDevice(data);\n      }).catch((error) => {\n        // geolocation.checkService() error\n        // describes the error\n        let m = ''\n        switch (error.code) {\n          case 1:\n            m= 'Devi autorizzare la localizzazione'\n            break\n          case 2:\n            m = 'Errore di rete GPS.'\n            break\n          case 3:\n            m = 'Timeout GPS.'\n            break\n          default:\n            m = 'Errore GPS ' + error.code + ', ' + error.message\n            break\n        }\n        this.statusDesc = m + '<br><br>Nuovo tentativo in ' + this.retryDelay  + '\"...'\n        setTimeout(() => {\n          this.checkGeoLocationService()\n        }, this.retryDelay * 1000)\n      })\n    }, this.execDelay * 1000);\n  }\n\n  registerDevice(data) {\n    /**\n     * step 4: register/updates the device via API\n     */\n     this.api.deviceAdd(this.utils.getDeviceData(), data).then((result) => {\n      // device added/updated via API: navigate to login page\n      setTimeout(() => {\n        this.navCtrl.navigateRoot('login-veichle')\n      }, this.execDelay * 1000);\n    }).catch((error) => {\n      // API Error\n      this.components.showAlert(error['message'], 'Si Ã¨ verificato un errore', error['message_details']);\n      window.location.reload()\n    });\n  }\n  // #endregion Public Methods\n}\n","export default \"<!--\\n/*\\n * start/start.page\\n * start/loading page\\n * route: start (default route)\\n *\\n * NOTES:\\n *  this is the 1st page loaded when APP starts\\n *\\n *  step 1: checks internet connection\\n *  step 2: try to ping the MGN server API\\n *  step 3: checks geo-location service\\n *\\n *  each step is shown into div#statusDesc\\n *  step 4: if everything's ok registers/updates the device via API, then navigate to login page\\n */\\n-->\\n<ion-content [fullscreen]=\\\"true\\\" class=\\\"center\\\">\\n  <img src=\\\"assets/ani/start.gif\\\" />\\n  <br>\\n  <div id=\\\"statusDesc\\\">\\n    <p [innerHTML]=\\\"statusDesc\\\"></p>\\n  </div>\\n</ion-content>\\n\\n<!-- Footer -->\\n<ion-footer class=\\\"ion-no-border\\\">\\n  <ion-grid>\\n    <ion-row no-padding no-margin>\\n        <ion-col col-12 no-padding class=\\\"center\\\">\\n          {{ app.appName() }} v.{{ app.appVersion() }}\\n        </ion-col>\\n    </ion-row>\\n  </ion-grid>\\n</ion-footer>\\n\";","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzdGFydC5wYWdlLnNjc3MifQ== */\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { StartPage } from './start.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: StartPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class StartPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { StartPageRoutingModule } from './start-routing.module';\n\nimport { StartPage } from './start.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    StartPageRoutingModule\n  ],\n  declarations: [StartPage]\n})\nexport class StartPageModule {}\n"],"sourceRoot":"webpack:///"}